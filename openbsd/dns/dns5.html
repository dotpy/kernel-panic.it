<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="resource-type" content="document" />
  <meta name="keywords" content="kernel,panic,OpenBSD,dns,bind,domain,name,system" />
  <meta name="distribution" content="global" />
  <meta name="author" content="Daniele Mazzocchio" />
  <meta name="copyright" content="This document copyright 2005-2014 by Kernel-Panic.it." />

  <title>OpenBSD as a domain name server - Appendix A: the complete configuration and zone data files</title>

  <link rel="stylesheet" type="text/css" href="../../css/docs.css" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

</head>

<body>

  <div class="navigation">
    <ul>
      <li class="prev"><a class="nav-list" href="dns4.html"><span>Previous</span></a></li>
      <li class="up"><a class="nav-list" href="index.html"><span>Up</span></a></li>
      <li class="next"><a class="nav-list" href="dns6.html"><span>Next</span></a></li>
      <li class="home"><a class="nav-list" href="../../index.html"><span>Home</span></a></li>
    </ul>
    <h3>OpenBSD as a domain name server</h3>
    <div>Previous: <a href="dns4.html">4. Further Bind configuration</a>&nbsp;
         Up: <a href="index.html">Table of contents</a>&nbsp;
         Next: <a href="dns6.html">6. Appendix B</a>
    </div>
  </div>

  <hr />

<h2>5. Appendix A</h2>


<h3><a id="dns-5.1" name="dns-5.1"></a>5.1 First draft of the configuration and zone data files</h3>

<p>Our (modest) initial goal was to set up a couple of name servers, with a very <a href="dns3.html">basic configuration</a>, and get them to do their job, without caring much about <a href="dns4.html#dns-4.4">security</a>, <a href="dns4.html#dns-4.5">logging</a> or advanced features like <a href="dns4.html#dns-4.2">delegation</a>, <a href="dns4.html#dns-4.3">dynamic update</a> or <a href="dns4.html#dns-4.1">views</a>. Since we have examined configuration and zone data files one piece at a time, you may find it useful to have a look at them as a whole.</p>

<h4><a id="dns-5.1.1" name="dns-5.1.1"></a>5.1.1 DMZ primary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
options {
    directory       &quot;/&quot;;
};

zone &quot;kernel-panic.it&quot; {
    type            master;
    file            &quot;master/db.kernel-panic.it&quot;;
};

zone &quot;240.16.172.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.172.16.240&quot;;
};

zone &quot;250.16.172.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.172.16.250&quot;;
};

zone &quot;3.2.1.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.1.2.3&quot;;
};

<i># Loopback address</i>
zone &quot;localhost&quot; {
    type            master;
    file            &quot;master/db.localhost&quot;;
};

zone &quot;127.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.127&quot;;
};

<i># Special zones</i>
zone &quot;255.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.255&quot;;
};

zone &quot;0.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.0&quot;;
};

<i># Root zone</i>
zone &quot;.&quot; {
    type            hint;
    file            &quot;master/root.hint&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.kernel-panic.it</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Mail exchangers</i>
                IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.

<i>; Addresses for the canonical names</i>
mail            IN A            172.16.240.150
proxy           IN A            172.16.240.151
www1            IN A            172.16.240.152
www2            IN A            172.16.240.153
dns1            IN A            172.16.240.154
dns2            IN A            172.16.240.155

mickey          IN A            172.16.0.200
                IN A            172.16.240.200
minnie          IN A            172.16.0.201
                IN A            172.16.240.201
donald          IN A            172.16.240.100
                IN A            172.16.250.100
daisy           IN A            172.16.240.101
                IN A            172.16.250.101
fw-int          IN A            172.16.0.202
                IN A            172.16.240.202
fw-ext          IN A            172.16.240.102
                IN A            172.16.250.102

router          IN A            172.16.250.1
                IN A            1.2.3.4

<i>; Aliases</i>
mk              IN CNAME        mickey
mn              IN CNAME        minnie
dn              IN CNAME        donald
ds              IN CNAME        daisy
fw1             IN CNAME        fw-int
fw2             IN CNAME        fw-ext

<i>; Interface specific names</i>
mk-lan          IN A            172.16.0.200
mk-dmz          IN A            172.16.240.200
mn-lan          IN A            172.16.0.201
mn-dmz          IN A            172.16.240.201
dn-dmz          IN A            172.16.240.100
dn-ext          IN A            172.16.250.100
ds-dmz          IN A            172.16.240.101
ds-ext          IN A            172.16.250.101
fw1-lan         IN A            172.16.0.202
fw1-dmz         IN A            172.16.240.202
fw2-dmz         IN A            172.16.240.102
fw2-ext         IN A            172.16.250.102
router-int      IN A            172.16.250.1
router-ext      IN A            1.2.3.4
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.172.16.240</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
100             IN PTR          donald.kernel-panic.it.
101             IN PTR          daisy.kernel-panic.it.
102             IN PTR          fw-ext.kernel-panic.it.
150             IN PTR          mail.kernel-panic.it.
151             IN PTR          proxy.kernel-panic.it.
152             IN PTR          www1.kernel-panic.it.
153             IN PTR          www2.kernel-panic.it.
154             IN PTR          dns1.kernel-panic.it.
155             IN PTR          dns2.kernel-panic.it.
200             IN PTR          mickey.kernel-panic.it.
201             IN PTR          minnie.kernel-panic.it.
202             IN PTR          fw-int.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.172.16.250</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1               IN PTR          router.kernel-panic.it.
100             IN PTR          donald.kernel-panic.it.
101             IN PTR          daisy.kernel-panic.it.
102             IN PTR          fw-ext.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.1.2.3</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
4               IN PTR          router.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/root.hint</div>
<pre>
<i>; formerly NS.INTERNIC.NET</i>
.                        3600000  IN  NS    A.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.      3600000      A     198.41.0.4
A.ROOT-SERVERS.NET.      3600000      AAAA  2001:503:BA3E::2:30

<i>; FORMERLY NS1.ISI.EDU</i>
.                        3600000      NS    B.ROOT-SERVERS.NET.
B.ROOT-SERVERS.NET.      3600000      A     192.228.79.201

<i>; FORMERLY C.PSI.NET</i>
.                        3600000      NS    C.ROOT-SERVERS.NET.
C.ROOT-SERVERS.NET.      3600000      A     192.33.4.12

<i>; FORMERLY TERP.UMD.EDU</i>
.                        3600000      NS    D.ROOT-SERVERS.NET.
D.ROOT-SERVERS.NET.      3600000      A     199.7.91.13
D.ROOT-SERVERS.NET.      3600000      AAAA  2001:500:2D::D

<i>; FORMERLY NS.NASA.GOV</i>
.                        3600000      NS    E.ROOT-SERVERS.NET.
E.ROOT-SERVERS.NET.      3600000      A     192.203.230.10

<i>; FORMERLY NS.ISC.ORG</i>
.                        3600000      NS    F.ROOT-SERVERS.NET.
F.ROOT-SERVERS.NET.      3600000      A     192.5.5.241
F.ROOT-SERVERS.NET.      3600000      AAAA  2001:500:2F::F

<i>; FORMERLY NS.NIC.DDN.MIL</i>
.                        3600000      NS    G.ROOT-SERVERS.NET.
G.ROOT-SERVERS.NET.      3600000      A     192.112.36.4

<i>; FORMERLY AOS.ARL.ARMY.MIL</i>
.                        3600000      NS    H.ROOT-SERVERS.NET.
H.ROOT-SERVERS.NET.      3600000      A     128.63.2.53
H.ROOT-SERVERS.NET.      3600000      AAAA  2001:500:1::803F:235

<i>; FORMERLY NIC.NORDU.NET</i>
.                        3600000      NS    I.ROOT-SERVERS.NET.
I.ROOT-SERVERS.NET.      3600000      A     192.36.148.17
I.ROOT-SERVERS.NET.      3600000      AAAA  2001:7FE::53

<i>; OPERATED BY VERISIGN, INC.</i>
.                        3600000      NS    J.ROOT-SERVERS.NET.
J.ROOT-SERVERS.NET.      3600000      A     192.58.128.30
J.ROOT-SERVERS.NET.      3600000      AAAA  2001:503:C27::2:30

<i>; OPERATED BY RIPE NCC</i>
.                        3600000      NS    K.ROOT-SERVERS.NET.
K.ROOT-SERVERS.NET.      3600000      A     193.0.14.129
K.ROOT-SERVERS.NET.      3600000      AAAA  2001:7FD::1

<i>; OPERATED BY ICANN</i>
.                        3600000      NS    L.ROOT-SERVERS.NET.
L.ROOT-SERVERS.NET.      3600000      A     199.7.83.42
L.ROOT-SERVERS.NET.      3600000      AAAA  2001:500:3::42

<i>; OPERATED BY WIDE</i>
.                        3600000      NS    M.ROOT-SERVERS.NET.
M.ROOT-SERVERS.NET.      3600000      A     202.12.27.33
M.ROOT-SERVERS.NET.      3600000      AAAA  2001:DC3::35
</pre>
</div>

<h4><a id="dns-5.1.2" name="dns-5.1.2"></a>5.1.2 DMZ secondary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
options {
    directory       &quot;/&quot;;
};

zone &quot;kernel-panic.it&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.kernel-panic.it&quot;;
};

zone &quot;240.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.172.16.240&quot;;
};

zone &quot;250.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.172.16.250&quot;;
};

zone &quot;3.2.1.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.1.2.3&quot;;
};

<i># Loopback address</i>
zone &quot;localhost&quot; {
    type            master;
    file            &quot;master/db.localhost&quot;;
};

zone &quot;127.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.127&quot;;
};

<i># Special zones</i>
zone &quot;255.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.255&quot;;
};

zone &quot;0.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.0&quot;;
};

<i># Root zone</i>
zone &quot;.&quot; {
    type            hint;
    file            &quot;master/root.hint&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/root.hint</div>
<pre>
<i>;formerly NS.INTERNIC.NET</i>
.                        3600000  IN  NS    A.ROOT-SERVERS.NET.
A.ROOT-SERVERS.NET.      3600000      A     198.41.0.4

<i>; formerly NS1.ISI.EDU</i>
.                        3600000      NS    B.ROOT-SERVERS.NET.
B.ROOT-SERVERS.NET.      3600000      A     192.228.79.201

<i>; formerly C.PSI.NET</i>
.                        3600000      NS    C.ROOT-SERVERS.NET.
C.ROOT-SERVERS.NET.      3600000      A     192.33.4.12

<i>; formerly TERP.UMD.EDU</i>
.                        3600000      NS    D.ROOT-SERVERS.NET.
D.ROOT-SERVERS.NET.      3600000      A     128.8.10.90

<i>; formerly NS.NASA.GOV</i>
.                        3600000      NS    E.ROOT-SERVERS.NET.
E.ROOT-SERVERS.NET.      3600000      A     192.203.230.10

<i>; formerly NS.ISC.ORG</i>
.                        3600000      NS    F.ROOT-SERVERS.NET.
F.ROOT-SERVERS.NET.      3600000      A     192.5.5.241

<i>; formerly NS.NIC.DDN.MIL</i>
.                        3600000      NS    G.ROOT-SERVERS.NET.
G.ROOT-SERVERS.NET.      3600000      A     192.112.36.4

<i>; formerly AOS.ARL.ARMY.MIL</i>
.                        3600000      NS    H.ROOT-SERVERS.NET.
H.ROOT-SERVERS.NET.      3600000      A     128.63.2.53

<i>; formerly NIC.NORDU.NET</i>
.                        3600000      NS    I.ROOT-SERVERS.NET.
I.ROOT-SERVERS.NET.      3600000      A     192.36.148.17

<i>; operated by VeriSign, Inc.</i>
.                        3600000      NS    J.ROOT-SERVERS.NET.
J.ROOT-SERVERS.NET.      3600000      A     192.58.128.30

<i>; operated by RIPE NCC</i>
.                        3600000      NS    K.ROOT-SERVERS.NET.
K.ROOT-SERVERS.NET.      3600000      A     193.0.14.129 

<i>; operated by ICANN</i>
.                        3600000      NS    L.ROOT-SERVERS.NET.
L.ROOT-SERVERS.NET.      3600000      A     198.32.64.12

<i>; operated by WIDE</i>
.                        3600000      NS    M.ROOT-SERVERS.NET.
M.ROOT-SERVERS.NET.      3600000      A     202.12.27.33
</pre>
</div>

<h3><a id="dns-5.2" name="dns-5.2"></a>5.2 Final version of the configuration and zone data files</h3>

<p>Once we had our name servers working, we decided to get into the serious stuff and configure some of Bind's most useful features, like <a href="dns4.html#dns-4.2">delegation</a>, <a href="dns4.html#dns-4.1">views</a>, <a href="dns4.html#dns-4.5">logging</a>, <a href="dns4.html#dns-4.3">dynamic update</a> and <a href="dns4.html#dns-4.3">TSIG</a>. Below are the complete configuration and zone data files.</p>

<h4><a id="dns-5.2.1" name="dns-5.2.1"></a>5.2.1 DMZ primary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
<i>/******************************************************************************
 * This is the primary master name server for the &quot;kernel-panic.it&quot; zone.     *
 * It accepts queries from both external and DMZ hosts, but uses different    *
 * namespaces. It accepts zone transfer requests only from the ISP's name     *
 * servers, the DMZ secondary master and the LAN name servers.                *
 ******************************************************************************/</i>

<i>/* TSIG keys ******************************************************************/</i>
key dns1-dns2.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;7U86ip+B+SRYirLGm4lxfg==&quot;;
};

key dns1-dns1.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;bvVFyHOWV/YjIdBbpAJZWQ==&quot;;
};

key dns1-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;1sMX8Xs5zEhpekJDyyNTDA==&quot;;
};

<i>/* ACLs ***********************************************************************/</i>
acl &quot;dmz&quot; {
    127/8; 172.16.240/24;
};

acl &quot;isp-ns&quot; {
    1.2.3.5; 1.2.3.6;
};

acl &quot;dmz-slaves&quot; {
    key dns1-dns2.kernel-panic.it.;
};

acl &quot;lan-slaves&quot; {
    key dns1-dns1.lan.kernel-panic.it.;
    key dns1-dns2.lan.kernel-panic.it.;
};

<i>/* rndc configuration *********************************************************/</i>
key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;Hp3cRzIhGLuzdPw53M2pHw==&quot;;
};

controls {
    inet            127.0.0.1 port 953
                    allow { 127.0.0.1; }
                    keys { &quot;rndc-key&quot;; };
};

<i>/* Options ********************************************************************/</i>
options {
    directory       &quot;/&quot;;
    version         &quot;Go hack yourself!&quot;;
};

<i>/* Logging ********************************************************************/</i>
logging {
    channel security_channel {
        file            &quot;log/security.log&quot;;
        severity        debug;
        print-time      yes;
        print-category  yes;
        print-severity  yes; 
    };

    channel default {
        syslog          local0;
        severity        info;
        print-category  yes;
        print-severity  yes;
    }

    category security {
        security_channel;
        default;
    };

    category lame-servers { null; };

    category default { default; };
};

<i>/* Authoritative zones ********************************************************/</i>
view &quot;dmz&quot; {
    match-clients   { &quot;dmz&quot;; };
    allow-transfer  { &quot;dmz-slaves&quot;; &quot;lan-slaves&quot;; };
    recursion       yes;

    zone &quot;kernel-panic.it&quot; {
        type        master;
        file        &quot;master/db.kernel-panic.it&quot;;
    };

    zone &quot;240.16.172.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.172.16.240&quot;;
    };

    zone &quot;250.16.172.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.172.16.250&quot;;
    };

    zone &quot;3.2.1.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.1.2.3&quot;;
    };

    <i># Loopback address</i>
    zone &quot;localhost&quot; {
        type        master;
        file        &quot;master/db.localhost&quot;;
    };

    zone &quot;127.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.127&quot;;
    };

    <i># Special zones</i>
    zone &quot;255.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.255&quot;;
    };

    zone &quot;0.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.0&quot;;
    };

    <i># Root zone</i>
    zone &quot;.&quot; {
        type        hint;
        file        &quot;master/root.hint&quot;;
    };
};

view &quot;internet&quot; {
    match-clients   { any; };
    allow-transfer  { &quot;isp-ns&quot;; };
    recursion       no;

    zone &quot;kernel-panic.it&quot; {
        type        master;
        file        &quot;master/db.kernel-panic.it.shadow&quot;;
    };

    zone &quot;3.2.1.in-addr.arpa&quot; {
        type        master;
        file        &quot;master/db.1.2.3.shadow&quot;;
    };
};
</pre>
</div>

<div class="code">
  <div>/var/named/etc/rndc.conf</div>
<pre>
options {
    default-server  localhost;
    default-port    953;
    default-key     &quot;rndc-key&quot;;
};

server localhost {
    key             &quot;rndc-key&quot;;
};

key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;Hp3cRzIhGLuzdPw53M2pHw==&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.kernel-panic.it</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Mail exchangers</i>
                IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.

<i>; Delegated zone</i>
lan             IN NS           dns1.lan.kernel-panic.it.
                IN NS           dns2.lan.kernel-panic.it.

dns1.lan        IN A            172.16.0.161
dns2.lan        IN A            172.16.0.162

<i>; Addresses for the canonical names</i>
mail            IN A            172.16.240.150
proxy           IN A            172.16.240.151
www1            IN A            172.16.240.152
www2            IN A            172.16.240.153
dns1            IN A            172.16.240.154
dns2            IN A            172.16.240.155

mickey          IN A            172.16.0.200
                IN A            172.16.240.200
minnie          IN A            172.16.0.201
                IN A            172.16.240.201
donald          IN A            172.16.240.100
                IN A            172.16.250.100
daisy           IN A            172.16.240.101
                IN A            172.16.250.101
fw-int          IN A            172.16.0.202
                IN A            172.16.240.202
fw-ext          IN A            172.16.240.102
                IN A            172.16.250.102

router          IN A            172.16.250.1
                IN A            1.2.3.4

<i>; Aliases</i>
mk              IN CNAME        mickey
mn              IN CNAME        minnie
dn              IN CNAME        donald
ds              IN CNAME        daisy
fw1             IN CNAME        fw-int
fw2             IN CNAME        fw-ext

<i>; Interface specific names</i>
mk-lan          IN A            172.16.0.200
mk-dmz          IN A            172.16.240.200
mn-lan          IN A            172.16.0.201
mn-dmz          IN A            172.16.240.201
dn-dmz          IN A            172.16.240.100
dn-ext          IN A            172.16.250.100
ds-dmz          IN A            172.16.240.101
ds-ext          IN A            172.16.250.101
fw1-lan         IN A            172.16.0.202
fw1-dmz         IN A            172.16.240.202
fw2-dmz         IN A            172.16.240.102
fw2-ext         IN A            172.16.250.102
router-int      IN A            172.16.250.1
router-ext      IN A            1.2.3.4
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.172.16.240</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
100             IN PTR          donald.kernel-panic.it.
101             IN PTR          daisy.kernel-panic.it.
102             IN PTR          fw-ext.kernel-panic.it.
150             IN PTR          mail.kernel-panic.it.
151             IN PTR          proxy.kernel-panic.it.
152             IN PTR          www1.kernel-panic.it.
153             IN PTR          www2.kernel-panic.it.
154             IN PTR          dns1.kernel-panic.it.
155             IN PTR          dns2.kernel-panic.it.
200             IN PTR          mickey.kernel-panic.it.
201             IN PTR          minnie.kernel-panic.it.
202             IN PTR          fw-int.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.172.16.250</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1               IN PTR          router.kernel-panic.it.
100             IN PTR          donald.kernel-panic.it.
101             IN PTR          daisy.kernel-panic.it.
102             IN PTR          fw-ext.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.1.2.3</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Mail exchangers</i>
                IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.

<i>; Addresses (pointing to canonical names)</i>
4               IN PTR          router.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.kernel-panic.it.shadow</div>
<pre>
$TTL 1d

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns.kernel-panic.it.
                IN NS           dns.provider.com.

<i>; Mail exchangers</i>
                IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.

<i>; Addresses for the canonical names</i>
                IN A            1.2.3.4

<i>; Aliases</i>
www             IN CNAME        kernel-panic.it.
mail            IN CNAME        kernel-panic.it.
dns             IN CNAME        kernel-panic.it.

<i>; Deault mail exchangers</i>
*               IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.1.2.3.shadow</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns.provider.com.

<i>; Addresses (pointing to canonical names)</i>
4               IN PTR          kernel-panic.it.
</pre>
</div>

<h4><a id="dns-5.2.2" name="dns-5.2.2"></a>5.2.2 DMZ secondary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
<i>/******************************************************************************
 * This is the secondary master name server for the &quot;kernel-panic.it&quot; zone.   *
 * It accepts queries only from DMZ hosts and zone transfer requests from the *
 * ISP's name servers and the LAN name servers.                               *
 ******************************************************************************/</i>

<i>/* TSIG keys ******************************************************************/</i>
key dns1-dns2.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;7U86ip+B+SRYirLGm4lxfg==&quot;;
};

key dns2-dns1.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;uyUkoNVWKxah/Zr+Xcd8vQ==&quot;;
};

key dns2-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;Y2hqf7mCvqnQf8UFOJ2CyA==&quot;;
};

server 172.16.240.154 {
    keys            { dns1-dns2.kernel-panic.it.; };
};

<i>/* ACLs ***********************************************************************/</i>
acl &quot;dmz&quot; {
    127/8; 172.16.240/24;
};

acl &quot;isp-ns&quot; {
    1.2.3.5; 1.2.3.6;
};

acl &quot;lan-slaves&quot; {
    key dns2-dns1.lan.kernel-panic.it.;
    key dns2-dns2.lan.kernel-panic.it.;
};

<i>/* rndc configuration *********************************************************/</i>
key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;3F5oVjZ2fRE/7x2NPy8rZA==&quot;;
};

controls {
    inet            127.0.0.1 port 953
                    allow { 127.0.0.1; }
                    keys { &quot;rndc-key&quot;; };
};

<i>/* Options ********************************************************************/</i>
options {
    directory       &quot;/&quot;;
    version         &quot;Go hack yourself!&quot;;
    allow-query     { &quot;dmz&quot;; };
    allow-transfer  { &quot;isp-ns&quot;; &quot;lan-slaves&quot;; };
    recursion       yes;
};

/* Logging ********************************************************************/
logging {
    channel security_channel {
        file            &quot;log/security.log&quot;;
        severity        debug;
        print-time      yes;
        print-category  yes;
        print-severity  yes; 
    };

    channel default {
        syslog          local0;
        severity        info;
        print-category  yes;
        print-severity  yes;
    }

    category security {
        security_channel;
        default;
    };

    category lame-servers { null; };

    category default { default; };
};

<i>/* Authoritative zones ********************************************************/</i>
zone &quot;kernel-panic.it&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.kernel-panic.it&quot;;
};

zone &quot;240.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.172.16.240&quot;;
};

zone &quot;250.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.172.16.250&quot;;
};

zone &quot;3.2.1.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; };
    file            &quot;slave/bak.1.2.3&quot;;
};

<i># Loopback address</i>
zone &quot;localhost&quot; {
    type            master;
    file            &quot;master/db.localhost&quot;;
};

zone &quot;127.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.127&quot;;
};

<i># Special zones</i>
zone &quot;255.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.255&quot;;
};

zone &quot;0.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.0&quot;;
};

<i># Root zone</i>
zone &quot;.&quot; {
    type            hint;
    file            &quot;master/root.hint&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/etc/rndc.conf</div>
<pre>
options {
    default-server  localhost;
    default-port    953;
    default-key     &quot;rndc-key&quot;;
};

server localhost {
    key             &quot;rndc-key&quot;;
};

key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;3F5oVjZ2fRE/7x2NPy8rZA==&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<h4><a id="dns-5.2.3" name="dns-5.2.3"></a>5.2.3 LAN primary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
<i>/******************************************************************************
 * This is the primary master name server for the &quot;lan.kernel-panic.it&quot; zone  *
 * and a secondary master name server for the &quot;kernel-panic.it&quot; zone.         *
 * It accepts queries from internal hosts and zone transfers requests only    *
 * from the LAN secondary master. The DHCP server can dynamically update      *
 * clients resource records.                                                  *
 ******************************************************************************/</i>

<i>/* TSIG keys ******************************************************************/</i>
key dns1-dns1.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;bvVFyHOWV/YjIdBbpAJZWQ==&quot;;
};

key dns2-dns1.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;uyUkoNVWKxah/Zr+Xcd8vQ==&quot;;
};

key dns1.lan-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;Cn0Xj2v6u7CGNeRSIfS1JQ==&quot;;
};

key dns1.lan-dhcp.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;9+MU2qJwwl9nk7ptG84kpQ==&quot;;
};

server 172.16.240.154 {
    keys            { dns1-dns1.lan.kernel-panic.it.; };
};

server 172.16.240.155 {
    keys            { dns2-dns1.lan.kernel-panic.it.; };
};

<i>/* ACLs ***********************************************************************/</i>
acl &quot;dmz&quot; {
    172.16.240/24;
};

acl &quot;lan&quot; {
    127/8; 172.16.0/24;
};

acl &quot;lan-slaves&quot; {
    key dns1.lan-dns2.lan.kernel-panic.it.;
};

<i>/* rndc configuration *********************************************************/</i>
key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;D6P3H5E+cWyeuSVEMZH5+Q==&quot;;
};

controls {
    inet            127.0.0.1 port 953
                    allow { 127.0.0.1; }
                    keys { &quot;rndc-key&quot;; };
};

<i>/* Options ********************************************************************/</i>
options {
    directory       &quot;/&quot;;
    version         &quot;Go hack yourself!&quot;;
    allow-query     { &quot;dmz&quot;; &quot;lan&quot;; };
    allow-transfer  { &quot;lan-slaves&quot;; };
    recursion       no;
};

/* Logging ********************************************************************/
logging {
    channel security_channel {
        file            &quot;log/security.log&quot;;
        severity        debug;
        print-time      yes;
        print-category  yes;
        print-severity  yes; 
    };

    channel default {
        syslog          local0;
        severity        info;
        print-category  yes;
        print-severity  yes;
    }

    category security {
        security_channel;
        default;
    };

    category lame-servers { null; };

    category default { default; };
};

<i>/* Authoritative zones ********************************************************/</i>
zone &quot;lan.kernel-panic.it&quot; {
    type            master;
    file            &quot;master/db.lan.kernel-panic.it&quot;;
    update-policy   { grant dns1.lan-dhcp.lan.kernel-panic.it.
                            subdomain lan.kernel-panic.it. A; };
    notify          yes;
};

zone &quot;0.16.172.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.172.16.0&quot;;
};

zone &quot;kernel-panic.it&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.kernel-panic.it&quot;;
};

zone &quot;240.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.172.16.240&quot;;
};

zone &quot;250.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.172.16.250&quot;;
};

zone &quot;3.2.1.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.1.2.3&quot;;
};

<i># Loopback address</i>
zone &quot;localhost&quot; {
    type            master;
    file            &quot;master/db.localhost&quot;;
};

zone &quot;127.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.127&quot;;
};

<i># Special zones</i>
zone &quot;255.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.255&quot;;
};

zone &quot;0.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.0&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/etc/rndc.conf</div>
<pre>
options {
    default-server  localhost;
    default-port    953;
    default-key     &quot;rndc-key&quot;;
};

server localhost {
    key             &quot;rndc-key&quot;;
};

key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;D6P3H5E+cWyeuSVEMZH5+Q==&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.lan.kernel-panic.it</div>
<pre>
$TTL 3h

@ IN SOA dns1.lan.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.lan.kernel-panic.it.
                IN NS           dns2.lan.kernel-panic.it.

<i>; Mail exchangers</i>
                IN MX   0       mail.kernel-panic.it.
                IN MX   10      mail.provider.com.

<i>; Addresses for the canonical names</i>
file            IN A            172.16.0.160
dns1            IN A            172.16.0.161
dns2            IN A            172.16.0.162
dhcp            IN A            172.16.0.163
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.172.16.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.lan.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.lan.kernel-panic.it.
                IN NS           dns2.lan.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
160             IN PTR          file.lan.kernel-panic.it.
161             IN PTR          dns1.lan.kernel-panic.it.
162             IN PTR          dns2.lan.kernel-panic.it.
163             IN PTR          dhcp.lan.kernel-panic.it.
200             IN PTR          mickey.kernel-panic.it.
201             IN PTR          minnie.kernel-panic.it.
202             IN PTR          fw-int.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.lan.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.lan.kernel-panic.it.
                IN NS           dns2.lan.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<h4><a id="dns-5.2.4" name="dns-5.2.4"></a>5.2.4 LAN secondary master</h4>

<div class="code">
  <div>/var/named/etc/named.conf</div>
<pre>
<i>/******************************************************************************
 * This is a secondary master name server for the &quot;lan.kernel-panic.it&quot; and   *
 * &quot;kernel-panic.it&quot; zones. It accepts queries only from internal hosts.      *
 ******************************************************************************/</i>

<i>/* TSIG keys ******************************************************************/</i>
key dns1-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;1sMX8Xs5zEhpekJDyyNTDA==&quot;;
};

key dns2-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;Y2hqf7mCvqnQf8UFOJ2CyA==&quot;;
};

key dns1.lan-dns2.lan.kernel-panic.it. {
    algorithm       hmac-md5;
    secret          &quot;Cn0Xj2v6u7CGNeRSIfS1JQ==&quot;;
};

server 172.16.240.154 {
    keys            { dns1-dns2.lan.kernel-panic.it.; };
};

server 172.16.240.155 {
    keys            { dns2-dns2.lan.kernel-panic.it.; };
};

server 172.16.0.161 {
    keys            { dns1.lan-dns2.lan.kernel-panic.it.; };
};

<i>/* ACLs ***********************************************************************/</i>
acl &quot;dmz&quot; {
    172.16.240/24;
};

acl &quot;lan&quot; {
    127/8; 172.16.0/24;
};

<i>/* rndc configuration *********************************************************/</i>
key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;vb5zPXhAfsJx+5zl4cC5Xg==&quot;;
};

controls {
    inet            127.0.0.1 port 953
                    allow { 127.0.0.1; }
                    keys { &quot;rndc-key&quot;; };
};

<i>/* Options ********************************************************************/</i>
options {
    directory       &quot;/&quot;;
    version         &quot;Go hack yourself!&quot;;
    allow-query     { &quot;dmz&quot;; &quot;lan&quot;; };
    allow-transfer  { none; };
    recursion       no;
};

/* Logging ********************************************************************/
logging {
    channel security_channel {
        file            &quot;log/security.log&quot;;
        severity        debug;
        print-time      yes;
        print-category  yes;
        print-severity  yes; 
    };

    channel default {
        syslog          local0;
        severity        info;
        print-category  yes;
        print-severity  yes;
    }

    category security {
        security_channel;
        default;
    };

    category lame-servers { null; };

    category default { default; };
};

<i>/* Authoritative zones ********************************************************/</i>
zone &quot;lan.kernel-panic.it&quot; {
    type            slave;
    masters         { 172.16.0.161; };
    file            &quot;slave/bak.lan.kernel-panic.it&quot;;
};

zone &quot;0.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.0.161; };
    file            &quot;slave/bak.172.16.0&quot;;
};

zone &quot;kernel-panic.it&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.kernel-panic.it&quot;;
};

zone &quot;240.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.172.16.240&quot;;
};

zone &quot;250.16.172.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.172.16.250&quot;;
};

zone &quot;3.2.1.in-addr.arpa&quot; {
    type            slave;
    masters         { 172.16.240.154; 172.16.240.155; };
    file            &quot;slave/bak.1.2.3&quot;;
};

<i># Loopback address</i>
zone &quot;localhost&quot; {
    type            master;
    file            &quot;master/db.localhost&quot;;
};

zone &quot;127.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.127&quot;;
};

<i># Special zones</i>
zone &quot;255.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.255&quot;;
};

zone &quot;0.in-addr.arpa&quot; {
    type            master;
    file            &quot;master/db.0&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/etc/rndc.conf</div>
<pre>
options {
    default-server  localhost;
    default-port    953;
    default-key     &quot;rndc-key&quot;;
};

server localhost {
    key             &quot;rndc-key&quot;;
};

key &quot;rndc-key&quot; {
    algorithm       hmac-md5;
    secret          &quot;vb5zPXhAfsJx+5zl4cC5Xg==&quot;;
};
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.localhost</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.

<i>; Addresses for the canonical names</i>
                IN A            127.0.0.1
                IN AAAA         ::1
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.127</div>
<pre>
$TTL 3h

@ IN SOA dns1.lan.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.lan.kernel-panic.it.
                IN NS           dns2.lan.kernel-panic.it.

<i>; Addresses (pointing to canonical names)</i>
1.0.0           IN PTR          localhost.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.255</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

<div class="code">
  <div>/var/named/master/db.0</div>
<pre>
$TTL 3h

@ IN SOA dns1.kernel-panic.it. danix.kernel-panic.it. (
        2007020601 <i>; serial</i>
        3h         <i>; refresh after 3 hours</i>
        1h         <i>; retry after 1 hour</i>
        1w         <i>; expire after 1 week</i>
        1h )       <i>; negative caching TTL of 1 hour</i>

<i>; Name servers</i>
                IN NS           dns1.kernel-panic.it.
                IN NS           dns2.kernel-panic.it.
</pre>
</div>

  <hr />

  <div class="navigation">
    <ul>
      <li class="prev"><a class="nav-list" href="dns4.html"><span>Previous</span></a></li>
      <li class="up"><a class="nav-list" href="index.html"><span>Up</span></a></li>
      <li class="next"><a class="nav-list" href="dns6.html"><span>Next</span></a></li>
      <li class="home"><a class="nav-list" href="../../index.html"><span>Home</span></a></li>
    </ul>
    <h3>OpenBSD as a domain name server</h3>
    <div>Previous: <a href="dns4.html">4. Further Bind configuration</a>&nbsp;
         Up: <a href="index.html">Table of contents</a>&nbsp;
         Next: <a href="dns6.html">6. Appendix B</a>
    </div>
  </div>

</body>

</html>

