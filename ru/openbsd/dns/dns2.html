<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>

  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="resource-type" content="document" />
  <meta name="keywords" content="kernel,panic,OpenBSD,dns,bind,domain,name,system" />
  <meta name="distribution" content="global" />
  <meta name="author" content="Daniele Mazzocchio" />
  <meta name="copyright" content="This document copyright 2005-2012 by Kernel-Panic.it." />

  <title>OpenBSD в качестве сервера доменных имен - Система доменных имен</title>

  <link rel="stylesheet" type="text/css" href="../../../css/docs.css" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

</head>

<body>

  <div class="navigation">
    <ul>
      <li class="prev"><a class="nav-list" href="dns1.html"><span>Назад</span></a></li>
      <li class="up"><a class="nav-list" href="index.html"><span>Начало</span></a></li>
      <li class="next"><a class="nav-list" href="dns3.html"><span>Далее</span></a></li>
      <li class="home"><a class="nav-list" href="../../../index.html"><span>На главную</span></a></li>
    </ul>
    <h3>OpenBSD в качестве сервера доменных имен</h3>
    <div>Назад: <a href="dns1.html">1. Введение</a>&nbsp;
         Начало: <a href="index.html">Содержание</a>&nbsp;
         Далее: <a href="dns3.html">3. Базовая конфигурация</a>
    </div>
  </div>

  <hr />

<h2>2. Система доменных имен</h2>

<p>Настраивать <acronym title="Domain Name System">DNS</acronym> будет намного легче, 
если у вас есть хорошее понимание основ. Поэтому, прежде чем спешить 
<a href="dns3.html">редактировать</a> наши файлы данных зоны, давайте кратко 
рассмотрим общую архитектуру системы доменных имен и его внутренние механизмы.</p>

<h3><a id="dns-2.1" name="dns-2.1"></a>2.1 Несколько определений</h3>

<p><dfn>Система доменных имен</dfn> представляет собой распределенную базу данных 
<a href="#dns-2.4">записей ресурсов</a> (см. [<a href="http://www.faqs.org/rfcs/rfc1034.html">RFC1034</a>]), 
связывая много типов информации (например, IP-адрес, почтовый сервер и т.д.) 
с доменными именами. Как и в файловой системе Unix, структура этой базы данных 
представляет собой иерархию перевернутого дерева с корнем в вершине. 
Все дерево называется <dfn>Пространством Доменных Имен</dfn>.</p>

<div class="block-img">
  <img src="dns1.png" alt="DNS Namespace vs. Unix FileSystem" width="800" height="260" />
</div>

<p>Каждый узел в пространстве доменных имен имеет текстовую метку (корневой узел 
имеет особую метку нулевой длины, "") и однозначно идентифицируется по <dfn>имени домена</dfn>, 
например, список меток на пути от узла до корня, разделенных точками (пути в Unix, 
напротив, начинаются с корня и разделяются косыми чертами (slash)).</p>
<p>Например, доменное имя, выделенное на следующем изображении, состоит из 
последовательности &quot;www&quot;, &quot;kernel-panic&quot;, &quot;it&quot; и 
нулевой метки корня и поэтому пишется как &quot;www.kernel-panic.it.&quot;.</p>

<div class="block-img">
  <img src="dns2.png" alt="Domain Name" width="400" height="260" />
</div>

<p>Так как корневой узел обычно записывается в виде одной точки, доменные имена, 
оканчивающиеся на завершающую точку, считаются абсолютными (по аналогии с 
абсолютным путем Unix, начинающимся с косой черты). Абсолютное доменное имя также 
называется <dfn>полностью определенным доменным именем</dfn> (FQDN). Доменные имена, не 
завершающиеся точкой, считаются относительными по отношению к другому домену, 
как правило, самому корню. Относительное доменное имя также упоминается как 
<dfn>частично определенное доменное имя</dfn> (PQDN).</p>
<p><dfn>Домен</dfn> представляет собой поддерево пространства доменных имен и 
принимает доменное имя его верхнего узла. Каждый домен может иметь свои собственные 
поддеревья, называемые <dfn>поддоменами</dfn>. Домены могут также быть разделены 
по уровням: домен <dfn>верхнего уровня</dfn> (или <dfn>первого уровня</dfn>) 
является потомком корня; домен <dfn>второго уровня</dfn> является потомком домена 
первого уровня и так далее.</p>

<div class="block-img">
  <img src="dns3.png" alt="Domains levels" width="700" height="260" />
</div>

<p>Иерархическая структура системы доменных имен позволяет децентрализовать ее 
администрирование, в самом деле, организация, отвечающая за домен, может <dfn>делегировать</dfn>, 
то есть возложить ответственность за субдомен на другую организацию, и только 
сопровождать информацию о не-делегированной части домена (так называемой <dfn>зоны</dfn>).</p>
<p>Программы, которые хранят информацию о зоне, называют <dfn>серверы доменных имен</dfn>
 и говорят, что они обладают <dfn>полномочиями</dfn> (являются авторитетными) в этой зоне. 
Есть два типа серверов имен:</p>

<ul>
  <li><dfn>первичный</dfn> сервер имен, который получают данные для этой 
зоны из локального файла (так называемого <dfn>файла данных зоны</dfn>);</li>
  <li><dfn>вторичный</dfn> сервер имен (или <dfn>подчиненный</dfn>), 
который получает данные от сервера имен, отвечающего за зону (так называемого, 
<dfn>главного сервера</dfn>), через <dfn>передачу зоны</dfn>, обычно, но не обязательно, 
главный сервер является первичным сервером зоны.</li>
</ul>

<p>Наличие двух типов серверов имен упрощает процесс администрирования, предоставляя 
единую точку конфигурирования, а также позволяя, при наличии нескольких серверов имен, 
имеющих полномочия для зоны, использовать избыточность, распределение нагрузки и оперативность.</p>

<h3><a id="dns-2.2" name="dns-2.2"></a>2.2 Процесс разрешения имен</h3>

<p>Клиенты, обращающиеся к серверам имен, называются <dfn>разрешителями (resolvers)</dfn>. В Bind 
разрешитель представляет собой библиотеку, которая должна быть связана с приложениями, 
требующими службы имен. Когда приложению требуется информация из пространства 
доменных имен, оно использует разрешитель для выполнения <dfn>запросов</dfn> к DNS 
серверу (как правило, корпоративному серверу или серверу 
<acronym title="Internet Service Provider">провайдера</acronym>). 
Если запрос относится к обслуживаемой зоне, то сервер DNS будет отвечать немедленно, 
в противном случае, он будет искать требуемые данные через пространство доменных имен. 
Этот процесс называется <dfn>разрешением имени</dfn>.</p>
<p>Есть два типа запросов DNS:</p>

<ul>
  <li><dfn>итеративные</dfn> (или <dfn>нерекурсивные</dfn>), которые представляют 
собой просто запрос у DNS сервера лучшего <em>уже</em> известного ему ответа;</li>
  <li><dfn>рекурсивные</dfn>, которые запрашивают у сервера DNS предоставить полный ответ 
на запрос или выдать сообщение об ошибке.</li>
</ul>

<p>Обычно разрешители выполняют рекурсивные запросы, возлагая бремя разрешения имени 
на запрашиваемый сервер имен; DNS-серверы, вместо этого, выполняют серию итерационных 
запросов по разным направлениям пока не получат требуемый ответ.</p>
<p>Давайте посмотрим на примере, как все это работает. Предположим, вы хотите
 посетить веб-сайт &quot;<tt>www.kernel-panic.it</tt>&quot;, вы вводите 
<acronym title="Uniform Resource Locator">URL</acronym> в браузере, нажимаете 
клавишу &quot;<tt>Enter</tt>&quot; и вот, что происходит далее:</p>

<ol>
  <li><img src="dns4.png" alt="The name resolution process" width="250" height="400" class="float-img" />
разрешитель выполняет рекурсивный запрос вашему корпоративному серверу DNS, 
ожидая в ответ IP-адрес веб-сервера &quot;<tt>www.kernel-panic.it</tt>&quot; или 
сообщение об ошибке;</li>
  <li>корпоративный DNS сервер не является авторитетным для запрашиваемой зоны, 
поэтому он посылает итеративный запрос по адресу доменного имени &quot;<tt>www.kernel-panic.it</tt>&quot; 
<dfn>корневому серверу имен</dfn>, то есть одному из 13 DNS серверов по всему миру, 
которым известны серверы имен, являющиеся авторитетными для каждой из зон верхнего уровня;</li>
  <li>запрашиваемый корневой сервер имен не будет, скорее всего, знать полный ответ, 
но он, конечно, знает, какие серверы имен являются авторитетными для &quot;<tt>it</tt>&quot; зоны. 
Таким образом, он отошлет ваш корпоративный сервер DNS к этим серверам имен;</li>
  <li>ваш DNS сервер выберет один из указанных серверов имен и отправит тот же 
итеративный запрос по доменному имени &quot;<tt>www.kernel-panic.it</tt>&quot;;</li>
  <li>запрошенный сервер имен &quot;<tt>it</tt>&quot; не будет, наверное, 
знать полный ответ и, следовательно, перенаправит ваш корпоративный сервер DNS к 
списку серверов имен, авторитетных для зоны &quot;<tt>kernel-panic.it</tt>&quot;;</li>
  <li>в результате, ваш DNS сервер нашел серверы имен, авторитетные для зоны 
&quot;<tt>kernel-panic.it</tt>&quot;, и пошлет тот же запрос одному из них;</li>
  <li>запрашиваемый сервер имен возвращает адрес доменного имени 
&quot;<tt>www.kernel-panic.it</tt>&quot;;</li>
  <li>ваш корпоративный сервер имен, наконец, сможет вернуть запрошенную информацию разрешителю.</li>
</ol>

<p>Как вы могли видеть, процесс разрешения может включать в себя довольно много 
шагов, но после каждого шага, сервер имен получает новую порцию информации о пространстве 
доменных имен. Например, в предыдущем примере, корпоративному серверу DNS стало 
известно о том, какие серверы являются авторитетными для зон &quot;<tt>it</tt>&quot; 
и &quot;<tt>kernel-panic.it</tt>&quot;. Так что теперь вы знаете, что происходит, 
если вы хотите подключиться к машине &quot;<tt>ftp.kernel-panic.it</tt>&quot;? 
Ваш корпоративный сервер уже знает имя авторитетного сервера для зоны &quot;<tt>kernel-panic.it</tt>&quot;, 
поэтому он будет посылать запрос непосредственно к одному из них и получит ответ 
в один этап, тем самым ускоряя процесс разрешения имени. Хранение полученных данных 
для использования в дальнейшем, называется <dfn>кэшированием</dfn>. Начиная с 
версии 4.9, Bind также отслеживает несуществующие домены (<dfn>отрицательное 
кэширование</dfn>), тем самым предотвращая повторение не удавшихся запросов.

<h3><a id="dns-2.3" name="dns-2.3"></a>2.3 Обратное разрешение имен</h3>

<p><dfn>Обратное разрешение имен</dfn> - это процесс преобразования IP-адреса 
обратно в FQDN. Хотя, как это может показаться, данная задача потребует перебора 
всего пространства доменных имен, на самом деле, это так же просто, как разрешение 
имен, потому что разработчики DNS создали специальный домен &quot;<tt>in-addr.arpa</tt>&quot;, 
который использует в качестве меток точечно-октетное представление IP-адресов.</p>
<p>Иными словами, домен <tt>in-addr.arpa</tt> имеет (или, если более точно, может 
иметь) до 256 поддоменов третьего уровня (с номерами от 0 до 255), что соответствует 
возможным значениям первого октета IP-адреса; каждый из этих 256 поддоменов могут, 
в свою очередь, иметь до 256 поддоменов четвертого уровня, также пронумерованных от 
0 до 255, что соответствует значениям второго октета, и так далее.</p>

<div class="block-img">
  <img src="dns5.png" alt="The in-addr.arpa domain" width="400" height="350" />
</div>

<p>Поэтому, чтобы найти связанное с IP-адресом полное доменное имя, разрешитель 
должен просто  запросить у сервера имен <tt>PTR</tt> запись (см. <a href="#dns-2.4">ниже</a>) 
соответствующего узла в домене <tt>in-addr.arpa</tt>. Например, чтобы получить 
доменное имя для IP-адреса <tt>62.149.140.23</tt>, разрешитель обращается к серверу 
DNS за <tt>PTR</tt> записью доменного имени &quot;<tt>23.140.149.62.in-addr.arpa</tt>&quot;.</p>
<p>Как вы можете видеть, в доменном имени <tt>in-addr.arpa</tt> IP-адреса показываются 
в обратном порядке. Это связано с принципиальной разницей между IP-адресами и 
доменными именами: IP-адреса конкретизируются (уточняются) слева направо, в то время 
как доменные имена, конкретизируются справа налево. Следовательно, наименование 
узлов в <tt>in-addr.arpa</tt> таким, казалось бы, странным способом, на самом деле 
позволяет IP-адресам правильно отражать иерархическую структуру системы доменных имен.</p>

<h3><a id="dns-2.4" name="dns-2.4"></a>2.4 Записи ресурсов</h3>

<p>Каждый узел в пространстве доменных имен имеет связанный с ним набор информационных ресурсов, 
состоящий из отдельных <dfn>записей ресурсов</dfn> (RR), которые могут быть пустыми. 
Эта информация содержится в текстовом виде в файлах данных зоны, 
в то же время, запросы и передачи зоны представляют его в двоичной форме. 
Запись ресурса состоит из пяти полей:</p>

<dl>
  <dt>Name</dt>
  <dd>Доменное имя, к которому относится запись ресурса</dd>
  <dt>Type</dt>
  <dd>Тип записи ресурса (см. <a href="#RRtypes">ниже</a>)</dd>
  <dt>TTL</dt>
  <dd>Время жизни РР, то есть, как долго разрешители должны держать его в кэше, 
        прежде чем она будет считаться устаревшей</dd>
  <dt>Class</dt>
  <dd>Тип сети или программного обеспечения, к которым применяется запись; 
        действующие классы Интернет (IN), CHAOSnett (CH) и Hesiod (HS). 
        Мы остановимся только на классе Интернет, который применяется ко всем 
        основанным на TCP/IP сетям и ​​на сегодняшний день является наиболее распространенным</dd>
  <dt>RDATA</dt>
  <dd>Актуальные ресурсные данные, связанные с доменным именем</dd>
</dl>

<p><a id="RRtypes" name="RRtypes"></a>Основные типы записей DNS (см. 
[<a href="http://www.faqs.org/rfcs/rfc1035.html">RFC1035</a>]):</p>

  <dl>
    <dt><tt>A</tt> (Address)</dt>
    <dd>32-разрядный IP адрес хоста</dd>
    <dt><tt>AAAA</tt> (IPv6 Address)</dt>
    <dd>Адрес хоста в формате IPv6</dd>
    <dt><tt>CNAME</tt> (Canonical Name)</dt>
    <dd>Задание псевдонима для доменного имени, то есть различные полные доменные имена (FQDN), 
        которые могут быть использованы для обозначения одного хоста</dd>
    <dt><tt>KEY</tt></dt>
    <dd>Общедоступный ключ сервера для TSIG и DNSSEC</dd>
    <dt><tt>MX</tt> (Mail eXchanger)</dt>
    <dd>Определяет список почтовых серверов, которым следует отправлять почту для этого домена</dd>
    <dt><tt>NS</tt> (Name Server)</dt>
    <dd>Авторитетный сервер имен для домена</dd>
    <dt><tt>PTR</tt> (Pointer)</dt>
    <dd>Указатель на другое место в пространстве доменных имен. Он в основном используется, 
чтобы связать доменное имя с IP-адресом в домене &quot;<tt>in-addr.arpa</tt>&quot; 
для обратного разрешения имен</dd>
    <dt><tt>SOA</tt> (Start Of Authority)</dt>
    <dd>Определяет начало авторитетной зоны</dd>
    <dt><tt>TXT</tt> (Text)</dt>
    <dd>текстовая строка, содержащая произвольные данные (до 255 байт), связанные с именем</dd>
  </dl>

  <hr />

  <div class="navigation">
    <ul>
      <li class="prev"><a class="nav-list" href="dns1.html"><span>Назад</span></a></li>
      <li class="up"><a class="nav-list" href="index.html"><span>Начало</span></a></li>
      <li class="next"><a class="nav-list" href="dns3.html"><span>Далее</span></a></li>
      <li class="home"><a class="nav-list" href="../../../index.html"><span>На главную</span></a></li>
    </ul>
    <h3>OpenBSD в качестве сервера доменных имен</h3>
    <div>Назад: <a href="dns1.html">1. Введение</a>&nbsp;
         Начало: <a href="index.html">Содержание</a>&nbsp;
         Далее: <a href="dns3.html">3. Базовая конфигурация</a>
    </div>
  </div>

</body>

</html>

